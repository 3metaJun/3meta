name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Read repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '24.11.1'

      - name: Install dependencies
        run: npm ci

      - name: Build all versions
        run: npm run build:all

      - name: Create tarball
        run: tar -czf 3meta-min-js.tar.gz dist/*.min.js dist/*.map

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            3meta-min-js.tar.gz
            dist/3meta.min.js
            dist/3meta.min.js.map
            dist/3meta.esm.js
          body: |
            ## ğŸ‰ 3meta ${{ github.ref_name }} - å…¨é‡å›½é™…åŒ–æ”¯æŒ

            æœ¬ç‰ˆæœ¬å®Œæˆäº†æ ¸å¿ƒå¼•æ“çš„é‡æ„ï¼Œå¹¶å®ç°äº†å®Œæ•´çš„å¤šè¯­è¨€æ”¯æŒã€‚
            
            ### âœ¨ ä¸»è¦æ›´æ–° (Feature)

            - **ğŸŒ å…¨é‡å›½é™…åŒ– (i18n)**ï¼šæ­£å¼æ”¯æŒ **ç®€ä½“ä¸­æ–‡ (zh-CN)**ã€**ç¹é«”ä¸­æ–‡ (zh-TW)** å’Œ **è‹±è¯­ (en-US)**ã€‚
            - **ğŸ›  CLI å·¥å…·å¢å¼º**ï¼š`qimen` å‘½ä»¤è¡Œå·¥å…·æ–°å¢ `--lang` å‚æ•°ï¼Œæ”¯æŒç›´æ¥è¾“å‡ºä¸åŒè¯­è¨€çš„æ’ç›˜ JSON æ•°æ®ã€‚
            - **ğŸ— æ¶æ„é‡æ„**ï¼šå®ç°äº†é€»è¾‘ä¸è§†å›¾çš„åˆ†ç¦»ã€‚åˆ†æå¼•æ“ï¼ˆAnalysis Engineï¼‰ç°åœ¨è¿”å›ç»“æ„åŒ–çš„æ ¼å¼åŒ–æ•°æ®ï¼Œè€Œéç¡¬ç¼–ç å­—ç¬¦ä¸²ï¼Œæ›´æ–¹ä¾¿ç¬¬ä¸‰æ–¹ UI é›†æˆã€‚
            - **ğŸ“š æ–‡æ¡£å‡çº§**ï¼šåŒæ­¥æ›´æ–°äº†ä¸­è‹±å¤šè¯­è¨€ç‰ˆæœ¬çš„ README åŠ CLI ä½¿ç”¨æ–‡æ¡£ã€‚
            
            ### ğŸ“¦ èµ„æºä¸‹è½½

            - **æµè§ˆå™¨/ç‹¬ç«‹ç‰ˆ**ï¼š`3meta-min-js.tar.gz`
            - **UMD æ ¼å¼**ï¼š`3meta.min.js`
            - **ESM æ¨¡å—**ï¼š`3meta.esm.js`
            
            ---
            
            ### ğŸ’¡ å¿«é€Ÿå°è¯• CLI
            
            ```bash
            # ä½¿ç”¨è‹±æ–‡è¾“å‡ºæ’ç›˜ç»“æœ
            node bin/qimen.js --date 2024-01-01T12:00:00 --lang en-US
            ```

            ### ğŸ“ æµè§ˆå™¨å¼•å…¥ç¤ºä¾‹

            ```html
            <script src="3meta.min.js"></script>
            <script>
              const chart = ThreeMeta.QimenChart.byDatetime('2024-01-01 12:00:00');
              console.log(chart);
            </script>
            ```
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

