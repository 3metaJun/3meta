name: Release

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build-and-release:
    runs-on: ubuntu-latest
    steps:
      - name: Read repository
        uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '24.11.1'

      - name: Install dependencies
        run: npm ci

      - name: Build all versions
        run: npm run build:all

      - name: Create tarball
        run: tar -czf 3meta-min-js.tar.gz dist/*.min.js dist/*.map

      - name: Create Release
        uses: softprops/action-gh-release@v1
        with:
          files: |
            3meta-min-js.tar.gz
            dist/3meta.min.js
            dist/3meta.min.js.map
            dist/3meta.esm.js
          body: |
            ## ğŸ‰ 3meta v2.0.0

            ### âœ¨ æ–°åŠŸèƒ½
            - âœ… æ–°å¢å€¼ä½¿é—¨æš—å¹²æ’å¸ƒ
            - âœ… æä¾›æµè§ˆå™¨ç‰ˆæœ¬
            - âœ… åŸºç¡€ i18n æ¡†æ¶
        
            ### ğŸ› ä¿®å¤çš„ BUG
            - ä¿®å¤å€¼ä½¿é—¨ä¸ºç©ºçš„ BUG
            - ä¿®å¤å€¼ç¬¦æ‰€åœ¨çš„å®«ç¼ºå°‘å¤©ç›˜å¤©å¹²çš„é—®é¢˜
            
            ### ğŸ“¦ ä¸‹è½½
            - **æµè§ˆå™¨ç‰ˆæœ¬**ï¼š`3meta-min-js.tar.gz`
            - **UMD æ ¼å¼**ï¼š`3meta.min.js`
            - **ESM æ ¼å¼**ï¼š`3meta.esm.js`

            ### ğŸ“ ä½¿ç”¨ç¤ºä¾‹
            ```html
            <script src="3meta.min.js"></script>
            <script>
              const chart = ThreeMeta.QimenChart.byDatetime('2023-12-01 12:00:00');
              console.log(chart);
            </script>
            ```
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

